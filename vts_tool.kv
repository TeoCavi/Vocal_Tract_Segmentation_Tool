#:import Factory kivy.factory.Factory

<RSpinner@Spinner>
    background_normal: ''
    background_color: (0,0,0,0)
    canvas.before:
        Color:
            rgba: (0.12,0.18,0.20,1)
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [self.height/2]

    option_cls: Factory.CustomSpinnerOptions

<CustomSpinnerOptions@SpinnerOption>:
    background_normal: ''
    background_color: (0.12,0.18,0.20,1)      # blue

    #on_release: 
        #self.background_color=1, 1, 0, 1    # yellow


<RButton@Button>
    background_normal: ''
    background_color: (0,0,0,0)
    canvas.before:
        Color:
            rgba: 0.12,0.18,0.20,1
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [self.height/2]

<RToggleButton@ToggleButton>
    color: (0.87, 0.91, 0.92, 1)  
    background_down: ''
    background_normal: ''
    background_color: (0,0,0,0)
    canvas.before:
        Color:
            rgba: (0.12,0.18,0.20,1) if self.state == 'normal' else self.bkcolor
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [self.height/2]

<MToggleButton@ToggleButton>
    background_down: ''
    background_normal: ''
    background_color: (0,0,0,0)
    text: 'OFF' if self.state == 'normal' else 'ON'
    color: (0.87, 0.91, 0.92, 1)
    font_size: 20
    canvas.before:
        Color:
            rgba: (0.12,0.18,0.20,1) if self.state == 'normal' else self.bkcolor
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [self.height/2]




<Home>:
    canvas.before:
        Color:
            rgba: 0.36, 0.54, 0.6, 1
        Rectangle:
            pos: self.pos
            size: self.size 
    padding: 5
    spacing:5
    orientation: "horizontal"

    sbj: _sbj
    pred: _pred
    msg: _msg
    mri: _mri
    mainbx: _mainbx
    slider: _slider
    bk: _bk
    ul: _ul
    hp: _hp
    sp: _sp
    to: _to
    ll: _ll
    heg: _heg
    bkg: _bkg
    ulg: _ulg
    hpg: _hpg
    spg: _spg
    tog: _tog
    llg: _llg
    he: _he
    toggle: _toggle
    model: _model
    play: _play
    graph: _graph
    switch: _switch
    textbar: _textbar


    BoxLayout:                          #connection part
        spacing: 5
        size_hint: (.8,1)
        orientation: "vertical"
        BoxLayout: 
            spacing: 15
            size_hint: (1,.2)      
            orientation:"vertical"
            BoxLayout:
                spacing: 5
                size_hint:(1,0.5)
                orientation:"vertical"
                BoxLayout:
                    orientation:"horizontal"
                    canvas.before:
                        Color:
                            rgba: (0.87, 0.91, 0.92, 1)
                        RoundedRectangle:
                            size: (self.size[0]/2, self.size[1])
                            pos: self.pos
                            radius: [self.height/2]
                    Label:
                        size_hint: (0.35, 1)
                        text: "Video:"
                        color: (0.12,0.18,0.20,1)
                        font_size:25          
                    RButton:    
                        id: _sbj
                        size_hint: (0.65, 1)
                        text: 'Select Video'
                        color: (0.87, 0.91, 0.92, 1) 
                        font_size:20 
                        text_size: self.size
                        halign: "center"
                        valign: "center"
                        press_v: False
                        on_press: root.SetupVideo()
                        #background_normal: ''
                        #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (1,1,1,1)
                    

                BoxLayout:
                    orientation:"horizontal"
                    canvas.before:
                        Color:
                            rgba: (0.87, 0.91, 0.92, 1)
                        RoundedRectangle:
                            size: (self.size[0]/2, self.size[1])
                            pos: self.pos
                            radius: [self.height/2]
                    Label:
                        size_hint: (0.35, 1)
                        text: "Model:"
                        color: (0.12,0.18,0.20,1)
                        font_size:25 
                    RSpinner:
                        id: _model
                        size_hint: (0.65, 1)
                        text: 'Select Model'
                        color: (0.87, 0.91, 0.92, 1)
                        text_size: self.size
                        font_size:20
                        halign: "center"
                        valign: "center"
                        disabled: True
                        click: False
                        press: False
                        on_text: self.click = True
                        on_press: self.press = True
                RButton:
                    id: _pred
                    size_hint: (1, 1)
                    text: "Predict"
                    text_size: self.size
                    font_size:30
                    halign: "center"
                    valign: "center"
                    disabled: True
                    on_press: root.Prediction()
                    #background_normal: ''
                    #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (1,1,1,1)

            BoxLayout:
                orientation:"horizontal"
                spacing: 29
                BoxLayout:
                    size_hint: (0.1, 1)
                BoxLayout:
                    size_hint: (0.5, 1)
                    id: _boxtog
                    padding: (0,10,0,0)
                    spacing: 15
                    orientation:"vertical"
                    canvas.before:
                        Color:
                            rgba: (0.87, 0.91, 0.92, 1)
                        RoundedRectangle:
                            size: (_boxtog.size[0]+14, _boxtog.size[1]+14)
                            pos: (_boxtog.pos[0]-7, _boxtog.pos[1]-7)
                            radius: [10]
                    BoxLayout:
                        size_hint: (1, 0.04)
                        orientation:"vertical"
                        Label:
                            text: "Labels:"
                            color: (0.12,0.18,0.20,1)
                            font_size:25
                    BoxLayout:
                        size_hint: (1, 0.96)
                        spacing: 1
                        id: _toggle
                        disabled: True
                        orientation:"vertical"
                        RToggleButton:
                            id: _bk
                            size_hint: (1, 0.045)
                            font_size:20
                            text: 'BACKGROUND'
                            state: 'normal'
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0, 0.4, 0.2, 1)
                            #background_down:''
                            #background_normal: ''
                            #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (0, 0.4, 0.2, 1)
                        RToggleButton:
                            id: _ul
                            size_hint: (1, 0.045)
                            font_size:20
                            text: 'UPPER LIP'
                            state: 'normal'
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0, 0, 1, 1)
                            #background_normal: ''
                            #background_down:''
                            #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (0, 0, 1, 1)
                        RToggleButton:
                            id: _hp
                            size_hint: (1, 0.045)
                            font_size:20
                            text: 'HARD PALATE'
                            state: 'normal'
                            on_press: root.Plotter(clear = False)
                            bkcolor: (1, 0, 0, 1)
                            #background_down:''
                            #background_normal: ''
                            #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (1, 0, 0, 1)
                        RToggleButton:
                            id: _sp
                            size_hint: (1, 0.045)
                            font_size:20
                            text: 'SOFT PALATE'
                            state: 'normal'
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0.9, 0.7, 0, 1)
                            #background_down:''
                            #background_normal: ''
                            #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (0.9, 0.7, 0, 1)
                        RToggleButton:
                            id: _to
                            size_hint: (1, 0.045)
                            font_size:20
                            text: 'TONGUE'
                            state: 'normal'
                            on_press: root.Plotter(clear = False)
                            bkcolor: (1, 0.07, 0.7, 1)
                            #background_down:''
                            #background_normal: ''
                            #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (1, 0.07, 0.7, 1)
                        RToggleButton:
                            id: _ll
                            size_hint: (1, 0.045)
                            font_size:20
                            text: 'LOWER LIP'
                            state: 'normal'
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0.6, 0.17, 0.93, 1)
                            #background_down:''
                            #background_normal: ''
                            #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (0.6, 0.17, 0.93, 1)
                        RToggleButton:
                            id: _he
                            size_hint: (1, 0.045)
                            text: 'HEAD'
                            font_size:20
                            state: 'normal'
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0.69, 0.13, 0.13, 1)
                            #background_down:''
                            #background_normal:''
                            #background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (0.69, 0.13, 0.13, 1)
                BoxLayout:
                    size_hint: (0.3, 1)
                    id: _boxgr
                    padding: (0,10,0,0)
                    spacing: 15
                    orientation:"vertical"
                    canvas.before:
                        Color:
                            rgba: (0.87, 0.91, 0.92, 1)
                        RoundedRectangle:
                            size: (_boxgr.size[0]+14, _boxgr.size[1]+14)
                            pos: (_boxgr.pos[0]-7, _boxgr.pos[1]-7)
                            radius: [10]
                    BoxLayout:
                        size_hint: (1, 0.04)
                        orientation:"vertical"
                        Label:
                            text: "Graph:"
                            color: (0.12,0.18,0.20,1)
                            font_size:25
                    BoxLayout:
                        size_hint: (1, 0.96)
                        spacing: 1
                        id: _switch
                        disabled: True
                        orientation:"vertical"
                        MToggleButton:
                            id: _bkg
                            state: 'normal'
                            size_hint: (1, 0.045)
                            #active: False
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0, 0.4, 0.2, 1)
                        MToggleButton:
                            id: _ulg
                            state: 'normal'
                            size_hint: (1, 0.045)
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0, 0, 1, 1)
                        MToggleButton:
                            id: _hpg
                            state: 'normal'
                            size_hint: (1, 0.045)
                            on_press: root.Plotter(clear = False)
                            bkcolor: (1, 0, 0, 1)
                        MToggleButton:
                            id: _spg
                            state: 'normal'
                            size_hint: (1, 0.045)
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0.9, 0.7, 0, 1)
                        MToggleButton:
                            id: _tog
                            state: 'normal'
                            size_hint: (1, 0.045)
                            on_press: root.Plotter(clear = False)
                            bkcolor: (1, 0.07, 0.7, 1)
                        MToggleButton:
                            id: _llg
                            state: 'normal'
                            size_hint: (1, 0.045)
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0.6, 0.17, 0.93, 1)
                        MToggleButton:
                            id: _heg
                            state: 'normal'
                            size_hint: (1, 0.045)
                            on_press: root.Plotter(clear = False)
                            bkcolor: (0.69, 0.13, 0.13, 1)
                BoxLayout:
                    size_hint: (0.1, 1)
        
            BoxLayout:
                size_hint: (1,1.4)
                ScrollView:
                    scrool_y:False
                    scrool_x:True
                    Graph:
                        id: _graph
                        #disabled: True
                        padding: 5
                        size_hint_x: 1
                        size_hint_y: 1
                        xlabel: 'Frames'
                        ylabel: 'Area [log]'
                        font_size:25
                        label_options: {'color': (0.12,0.18,0.20,1)}
                        ymin:0.09999
                        ymax:10
                        xmin:0
                        xmax:1
                        ylog: True 
                        x_ticks_major: 1
                        y_ticks_major: 1
                        y_ticks_minor: 10
                        x_grid_label: True
                        y_grid_label: True
                        x_grid: False
                        y_grid: False
                        border_color: 0.12,0.18,0.20,1
                        background_color: (0,0,0,0)
                        canvas.before:
                            Color:
                                rgba: (0.87, 0.91, 0.92, 1)
                            RoundedRectangle:
                                size: self.size
                                pos: self.pos
                                radius: [10]


    BoxLayout:                          #data visualization
        orientation:"vertical"
        spacing: 5
        size_hint:(1,1)
        id: _mainbx
        rect_image: self.rect_image
        BoxLayout:
            orientation: "horizontal"
            spacing: 0
            padding: (0,0)
            size_hint:(1,.075)
            BoxLayout:
                spacing: 5
                size_hint:(0.925,1)
                canvas.before:
                    Color:
                        rgba: (0.87, 0.91, 0.92, 1)
                    Rectangle:
                        size: (self.size[0]/2, self.size[1])
                        pos: (self.pos[0] + self.width/2, self.pos[1])
                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: [self.height/2]
                Label:
                    id: _msg
                    text: "Select video and model" 
                    color: (0.12,0.18,0.20,1)
                    text_size: self.width, None
                    font_size:25
                    height: self.texture_size[1]
                    halign: 'center'
                    valign: 'center'
            BoxLayout:
                id: _textbar
                size_hint:(0.075,1)
                spacing: 5
                canvas.before:
                    Color:
                        rgba: (0.87, 0.91, 0.92, 1)
                    Rectangle:
                        size: (self.size[0]/2, self.size[1])
                        pos: self.pos
                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: [self.height/2]
                    

        DrawScreen:
            id: _mri
            disabled: True
            size_hint: (1,1.1)
            size: self.size
            pos: self.pos
            state: 0
            check: False
            x0: 0
            y0: 0
            x1: 0
            y1: 0
            orientation: "horizontal"
            spacing:5
            on_touch_up: if self.disabled == False and self.check == True: root.Draw()

        BoxLayout:
            orientation: "horizontal"
            size_hint:(1,.05)
            spacing: 5
            ToggleButton:
                id: _play
                disabled: True
                size: self.size
                size_hint:(0.06,1)
                pos: self.pos
                frames:
                state: 'normal'
                background_normal: ''
                background_color: (0.12,0.18,0.20,1) if self.state == 'normal' else (1,1,0,1) 
                canvas.after:
                    Color:
                        rgba: 0.36, 0.54, 0.6, 1
                    Triangle:
                        points: self.pos[0], self.pos[1]+_play.height, self.pos[0]+_play.width, self.pos[1]+_play.height, self.pos[0]+_play.width, self.pos[1]+_play.height/2
                    Triangle:
                        points: self.pos[0], self.pos[1], self.pos[0]+_play.width, self.pos[1], self.pos[0]+_play.width, self.pos[1]+_play.height/2
            Slider:
                id: _slider
                step: 1
                orientation: 'horizontal'
                disabled: True
                on_value: root.Plotter(clear = True)
                background_normal: ''
                background_color: 0.12,0.18,0.20,1
            BoxLayout:
                size_hint:(0.1,1)
                canvas.before:
                    Color:
                        rgba: (0.87, 0.91, 0.92, 1)
                    RoundedRectangle:
                        size: self.size
                        pos: self.pos
                        radius: [self.height/2]
                Label:
                    text: str(int(_slider.value))
                    color: (0.12,0.18,0.20,1)
                    font_size: 20

        



